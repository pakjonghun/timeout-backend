## 초과근무 백엔드

## 사용 기술

- nestjs
  - nestjs 는 구조가 정해져있어서 프로젝트 구조 고민에 많은 시간을 쏟지 않아도 되어서 사용하게 되었습니다.   
- mysql, typeorm
- socket.io

## 기능
- 유저(User)
  - 로그인, 조인, 비밀번호 수정, 프로파일 수정, 내 정보 출력, 내 개인정보 출력
  - 로그인 로그아웃 성공 후 누가 로그인 했는지 login manager room 에 socket.io 에서 별돌 관리
  - 인가인증 : 쿠키에 JsonWebToken 을 넣어서 통신함
  - 소켓io 인증 : 로그인 성공시, 로그아웃 성공시 별도의 login logout 이벤트를 받아서 처리
    - socket 객에의 handshake auth 에 유저 id를 넣어서 처리
- 기록(Record)
  - 초과근무 기록을 
    - 저장, 편집, 삭제, 조회
    - 조회는 검색어, 정렬 조건으로 조회 하도록 쿼리문 작성
  - 기록을 저장 할때는 저장 후 변경된 리스트를 socket.io 로 관리자에게 보냄
  - 기록을 삭제할 때 도 삭제 후 변경된 리스트를 socket.io 로 관리자에게 보냄

## 아쉬운점
  - user, record 모듈만 있어서 로직이 길어지는 문제가 있습니다.
    - 좀더 세분화 해서 모듈을 나눌 필요가 있습니다.
  - socket.io 역시 게이트웨이를 더 많들어서 나눌 필요가 있습니다.
  - interceptor 기능을 이용해서 일괄적으로 response 타입을 data, message 로 했는데
    - 다른 예외가 생길 경우 처리하기가 까다로웠습니다. 
    - response 타입을 어떻게 쉽게 처리 할 것인지 고민을 더 해야 할 필요가 있다고 생각합니다.
  - socket.io 에서 각 유저의 로그인 여부등을 파악하기 위해 별도로 class 를 만들어서 유저를 저장해서 관리했는데
    - 서버를 종료하지 않고 계속 켜 두면 캐쉬가 쌓이고, 관리가 안되고 관리를 위해서 별도의 메서드를 또 만들어야 하는 등 의 번거로움이 있습니다.
    - class 를 만드는 방식 외 캐쉬를 좀 더 편하게 관리 할 수 있는 방법을 고민할 필요가 있습니다.

## 향후추진 계획
  - redis adapter 학습 후 적용
  - 모듈의 세분화(유저는 인증과 유저로 분리, 기록은 기록과 검색으로 분리)
  - gateway 세분화(유저 게이트웨이, 기록 게이트웨이로 분리)
  - 스케쥴 기능 추가(초과근무 시간이 지나면 자동으로 데이터 베이스 중 더미 데이터를 지우고 캐쉬를 삭제하는 기능 추가)
